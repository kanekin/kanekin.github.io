<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Tatsuya Kaneko</title><meta name=description content="Describe your website"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://kanekin.github.io/css/bootstrap.min.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic"><link rel=stylesheet href=https://kanekin.github.io/css/font-awesome.min.css><link rel=stylesheet href=https://kanekin.github.io/css/owl.carousel.css><link rel=stylesheet href=https://kanekin.github.io/css/owl.theme.css><link href=https://kanekin.github.io/css/style.default.css rel=stylesheet id=theme-stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link href=https://kanekin.github.io/css/custom.css rel=stylesheet><link rel="shortcut icon" href=https://kanekin.github.io/img/favicon.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-Z2CQV8PSY6','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div id=all><div class=container-fluid><div class="row row-offcanvas row-offcanvas-left"><div id=sidebar class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas"><div class=sidebar-content><p><img src=/img/portfolio/profile_picture.png class=img-responsive></p><h1 class=sidebar-heading><a href=https://kanekin.github.io>Tatsuya Kaneko</a></h1><p class=sidebar-p>iOS Developer with a strong product intuition.</p><p class=sidebar-p>Originally from Japan, currently based in Amsterdam, the Netherlands.</p><ul class=sidebar-menu><li><a href=https://kanekin.github.io/portfolio/>Home</a></li><li><a href=https://kanekin.github.io/article/>Articles</a></li><li><a href=https://kanekin.github.io/about/>About</a></li><li><a href=https://kanekin.github.io/contact/>Get in touch</a></li></ul><p class=social><a href=mailto:tatsuya.j.kaneko@gmail.com data-animate-hover=pulse class=email title=E-mail><i class="fa fa-envelope"></i></a>
<a href=https://www.linkedin.com/in/tatsuya-kaneko-89a87944/ data-animate-hover=pulse class=external title=LinkedIn><i class="fa fa-linkedin"></i></a>
<a href=https://github.com/kanekin data-animate-hover=pulse class=external title=GitHub><i class="fa fa-github"></i></a></p><div class=copyright><p class=credit>&copy;2022 Tatsuya Kaneko</p></div></div></div><div class="col-xs-12 col-sm-8 col-md-9 content-column white-background"><div class="small-navbar visible-xs"><button type=button data-toggle=offcanvas class="btn btn-ghost pull-left"> <i class="fa fa-align-left"></i>Menu</button><h1 class=small-navbar-heading><a href=https://kanekin.github.io>Tatsuya Kaneko</a></h1></div><div class=row><div class=col-lg-8><div class=content-column-content><h1>SwiftUI with Network requests: A complete example with TMDB API</h1><h4 id=tldr>TL;DR:</h4><p>We will make this app. (Screenshots)</p><h3 id=what-is-this-article>What is this article?</h3><p>iOS app built with Swift UI. It makes network calls to TMDB API to demonstrate the flow of fetching data and update the UI on iOS apps.</p><h3 id=target-audience>Target audience</h3><ul><li>People with prior programming experience but not on the iOS platform.<ul><li>Finished apple&rsquo;s official Swift UI tutorial and want to take it one step further.</li></ul></li><li>iOS Developers who have been primarily working on apps supporting iOS 12 and below, who didn&rsquo;t get to explore Swift UI.</li><li>iOS Developers who haven&rsquo;t gotten their hands on new async/await features available from iOS 15 onwards.</li></ul><h3 id=what-you-will-learn>What you will learn</h3><ul><li>Swift UI</li><li>MVVM</li><li>Network<ul><li>Error handling</li><li>Logging</li><li>Mocking data</li><li>Combine based vs Async based vs Closure</li></ul></li><li>Async Image loading</li></ul><h2 id=who-would-benefit-by-reading-this-article>Who would benefit by reading this article?</h2><h3 id=1-you-are-new-to-ios>1. You are new to iOS:</h3><p>Apple&rsquo;s official tutorial is a beautiful interactive tutorial. But it doesn&rsquo;t include handling network calls. If you are not an experienced iOS Developer, the network is possibly the first real headache. For instance, you might have to face the following problems:</p><ul><li>Concurrency</li><li>Error handling</li><li>Dynamically loading content</li><li>Authentication + Persisting token</li></ul><p>You might say it&rsquo;s not hard. I have seen many mistakes in the production code base of consumer-facing apps. The network is like veins running through the app. Most of interesting feature will most likely depends on your network layer. It would be painful if you have to refactor network layer later.</p><h3 id=2-you-havent-worked-on-swiftui-as-an-ios-developer>2. You haven&rsquo;t worked on SwiftUI as an iOS Developer:</h3><p>The lifecycle of UIs is significantly different from UIKit. Reactive way of handling data (Binding UI with variables that represents the state of the app using Combine) seems to be the way to go in SwiftUI. If you didn&rsquo;t work with RxSwift, this article might give you a good glance at how data flows in SwiftUI apps between UI and the network layer.</p><h3 id=3-you-havent-worked-on-asyncawait-features-ios-150-as-an-ios-developer>3. You haven&rsquo;t worked on async/await features (iOS 15.0+) as an iOS Developer:</h3><p>Since the introduction of Combine (iOS 13: 2019), some people have been building apps with Combine-based API from <code>URLSession</code>. (<code>.dataPublisher { ... }</code>). However Apple introduced a new API on <code>URLSession</code> in 2021 utilising <code>async/await</code>. In this article, I will be mainly using the new async/await based API from URLSession.
(I will also discuss why I prefer using async/await for network calls as well)</p><h2 id=why-are-you-writing-this-article>Why are you writing this article?</h2><p>There are many iOS articles out there. Why do we need more?</p><p>Until recently I was an iOS developer who didn&rsquo;t get to work with the latest features such as SwiftUI, Combine and async/await. The project that I have been working on needed to support iOS 12 and below. When I started to pick up the latest iOS tooling, I was overwhelmed by the many choices available. Network on iOS in 2022 especially has three valid choices using URLSessions, namely <code>.dataTask</code>, <code>.dataTaskPublisher</code>, <code>.data</code>. I found it difficult to decide which one to use even though I had years of iOS development experience.</p><p>Second, there are a lot of articles already but most of them are focused on single-page examples. It doesn&rsquo;t demonstrate the features in a multi-page environment. I think for beginners, it is still difficult to derive how things can be wired together when expanding the app from a single page app into a multi-page app where you have to manage the lifecycle of the views, passing dependency, handle errors, manage asynchronous image loading, persist authentication tokens.</p><p>Thirdly, Network is one of the essential parts of the app and yet usually a layer that is written once at the early stage of the app development and used for a long time. Even if you have years of professional experience working on large projects, you could have missed an opportunity to write your own network layer.</p><p>Therefore, I thought I can provide some values by writing a series of articles that provides examples that are relevant in real-world development and I explain the motivations of the choices I make. That is being said, it is based on my opinion. You can disagree with me and I am open to feedback.</p><h2 id=what-will-not-be-discussed>What will not be discussed</h2><p>I would like to avoid discussing the reasoning of app architecture in this article. I am aware that there are many different approaches and opinions around it. I have seen opinions like MVVM is not necessary and redundant, VIPER is better, MVP is great, let&rsquo;s go back to MVC, etc. After years of experience, I concluded that any app architecture works is fine. I am a firm believer of delivering meaningful features is more important than using the most sophisticated app architecture. Nothing is perfect, is it? Therefore let&rsquo;s get pragmatic and get things done!</p><h2 id=what-are-we-making>What are we making?</h2><p>An App that can fetch data from TMDB API. Features of the app includes:</p><ul><li>Display a list of movies</li><li>Display a details of a movie</li><li>Login</li></ul><h2 id=end-result>End result:</h2><p>(screen shots again)</p><h2 id=links>Links</h2><ul><li>Build a list view and details view with async/await based network calls</li><li>Error handling</li><li>Mocking data</li><li>Comparison between closure, Combine, async/await APIs</li><li>Login page</li></ul></div></div></div></div></div></div></div><script src=https://kanekin.github.io/js/jquery.min.js></script><script src=https://kanekin.github.io/js/bootstrap.min.js></script><script src=https://kanekin.github.io/js/jquery.cookie.js></script><script src=https://kanekin.github.io/js/ekko-lightbox.js></script><script src=https://kanekin.github.io/js/jquery.scrollTo.min.js></script><script src=https://kanekin.github.io/js/masonry.pkgd.min.js></script><script src=https://kanekin.github.io/js/imagesloaded.pkgd.min.js></script><script src=https://kanekin.github.io/js/owl.carousel.min.js></script><script src=https://kanekin.github.io/js/front.js></script></body></html>